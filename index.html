<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover, user-scalable=no"/>
  <title>YJ K-Stock Quant Dashboard PRO</title>
  <script type="text/javascript" src="https://s3.tradingview.com/tv.js"></script>
  <style>
    :root{
      --bg:#0b1220; --panel:#0f1a2e; --panel2:#0c1628; --line:rgba(148,163,184,.18);
      --txt:#e5e7eb; --muted:#94a3b8; --good:#34d399; --bad:#fb7185; --warn:#fbbf24;
      --accent:#60a5fa; --radius:16px;
      --vh: 1vh;
      --sat: env(safe-area-inset-top); --sab: env(safe-area-inset-bottom);
      --sal: env(safe-area-inset-left); --sar: env(safe-area-inset-right);
    }
    *{ box-sizing:border-box; -webkit-tap-highlight-color: transparent; }

    body{
      margin:0; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
      background: var(--bg); color:var(--txt); overflow:hidden;
      height: 100vh; height: calc(var(--vh, 1vh) * 100); touch-action: manipulation;
      padding-top: var(--sat); padding-bottom: var(--sab); padding-left: var(--sal); padding-right: var(--sar);
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
      -webkit-text-size-adjust: 100%;
      text-rendering: optimizeLegibility;
    }

    .app{ display:flex; flex-direction:column; height:100%; }
    .header-section { flex-shrink: 0; z-index: 100; background: var(--bg); }

    .tabbar{
      margin: 15px 20px; display: flex; align-items: center; gap: 10px; flex-shrink: 0;
      overflow-x: auto; scrollbar-width: none; -webkit-overflow-scrolling: touch; padding-right: 20px;
    }
    .tabbar::-webkit-scrollbar { display: none; }

    .tab-btn{
      padding: 10px 18px; border-radius: 10px; border: 1px solid var(--line);
      background: var(--panel); color: #fff; font-size: 14px; font-weight: 700;
      cursor: pointer; transition: 0.2s; white-space: nowrap; flex-shrink: 0;
    }
    .tab-btn.on{
      background: linear-gradient(135deg, #3b82f6, #2563eb); border-color: #60a5fa;
      box-shadow: 0 0 10px rgba(59, 130, 246, 0.3);
    }

    #perfFilterGroup {
      display: none; align-items: center; gap: 6px; margin-left: 5px; padding-left: 15px;
      border-left: 1px solid var(--line); animation: fadeIn 0.3s ease-out;
    }
    @keyframes fadeIn { from { opacity: 0; transform: translateX(-5px); } to { opacity: 1; transform: translateX(0); } }

    .filter-btn {
      background: var(--panel2); border: 1px solid var(--line); color: var(--muted);
      padding: 8px 12px; border-radius: 8px; font-size: 12px; font-weight: 700;
      cursor: pointer; transition: 0.2s; white-space: nowrap; flex-shrink: 0;
    }
    .filter-btn:hover { background: rgba(255,255,255,0.05); }
    .filter-btn.active {
      background: var(--txt); color: var(--bg) !important; border-color: var(--txt) !important;
      box-shadow: 0 0 8px rgba(255,255,255,0.2);
    }

    .filter-btn[data-filter="TREND"] { color: #34d399; border-color: rgba(52, 211, 153, 0.2); }
    .filter-btn[data-filter="PULLBACK"] { color: #fbbf24; border-color: rgba(251, 191, 36, 0.2); }
    .filter-btn[data-filter="BREAKOUT"] { color: #fb7185; border-color: rgba(251, 113, 133, 0.2); }
    .filter-btn[data-filter="SELL"] { color: #c084fc; border-color: rgba(192, 132, 252, 0.2); }

    .main{ flex:1; display:flex; overflow:hidden; padding: 0 20px 20px 20px; gap:20px; }

    @media (max-width: 1024px) {
      .main { flex-direction: column; overflow-y: auto; -webkit-overflow-scrolling: touch; padding: 0 12px 12px 12px; gap: 12px; }
      .content-area, #detailPanel { flex: none !important; width: 100% !important; height: auto !important; }
      #detailPanel { min-height: 520px; margin-bottom: 20px; }
      .table-container { max-height: 50vh; }

      /* âœ… (ì¶”ê°€) ëª¨ë°”ì¼ì—ì„œ Dailypick íƒ­ í…Œì´ë¸” ì˜ì—­ ë†’ì´ í™•ì¥ */
      #dailyView .table-container{
        max-height: 72vh;
        min-height: 64vh;
      }
    }

    @media (max-width: 520px){
      /* ë” ì‘ì€ í°ì—ì„œ í•œ ë²ˆ ë” ë„‰ë„‰íˆ */
      #dailyView .table-container{
        max-height: 78vh;
        min-height: 68vh;
      }
    }

    .content-area { flex: 1.3; display: flex; flex-direction: column; height: 100%; overflow: hidden; }

    #detailPanel{
      flex: 0.7; background: var(--panel); border: 1px solid var(--line); border-radius: var(--radius);
      display: none; flex-direction: column; overflow: hidden; animation: slideIn 0.3s ease-out;
    }
    @keyframes slideIn { from { opacity: 0; transform: translateX(20px); } to { opacity: 1; transform: translateX(0); } }

    .custom-scroll { overflow-y: auto; -webkit-overflow-scrolling: touch; }
    .custom-scroll::-webkit-scrollbar { width: 5px; height: 5px; }
    .custom-scroll::-webkit-scrollbar-track { background: transparent; }
    .custom-scroll::-webkit-scrollbar-thumb { background: #334155; border-radius: 4px; }

    .table-container{
      flex: 1; background: var(--panel2); border-radius: var(--radius); border: 1px solid var(--line);
      position: relative; display: flex; flex-direction: column; overflow: hidden;
    }
    .table-responsive { flex: 1; overflow: auto; -webkit-overflow-scrolling: touch; }

    table { width:100%; border-collapse:collapse; font-size:12px; min-width:820px; table-layout: fixed; }
    tr.clickable:hover { background: rgba(255,255,255,0.05); cursor: pointer; }
    tr.clickable:active { background: rgba(255,255,255,0.1); }

    th{
      background: #162136; color: var(--muted); padding: 12px 6px; text-align:left;
      position: sticky; top: 0; z-index: 20; border-bottom: 2px solid var(--accent); white-space: nowrap;
    }

    /* ì„±ê³¼ì¶”ì  ì •ë ¬ */
    th.sortable { cursor: pointer; user-select: none; }
    th.sortable:hover { color: #fff; background: #1e2d4a; }
    th.sortable::after { content: " â†•"; font-size: 10px; opacity: 0.3; }
    th.sort-desc::after { content: " â†“"; opacity: 1; color: var(--accent); }
    th.sort-asc::after { content: " â†‘"; opacity: 1; color: var(--accent); }

    td { padding: 10px 6px; border-bottom: 1px solid var(--line); white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
    .numRight { text-align:right; font-family: 'Roboto Mono', monospace; }

    /* ì»¬ëŸ¼ ë„ˆë¹„ */
    .col-code { width: 60px; } .col-name { width: 110px; } .col-price { width: 85px; } .col-rsi { width: 60px; }
    .col-stoch { width: 65px; } .col-turn { width: 85px; } .col-sig { width: 140px; } .col-date { width: 85px; }
    .col-perf { width: 70px; } .col-sell { width: 65px; }

    /* Dailypick ì „ìš© */
    .col-type { width: 72px; text-align:center; }
    .col-target { width: 82px; }
    .col-stop { width: 82px; }
    .col-pnl { width: 110px; }

    .top-stats-container { display: flex; justify-content: flex-start; margin-bottom: 15px; flex-shrink: 0; width: 100%; }

    .mini-card{
      background: var(--panel2); border: 1px solid var(--line); border-radius: 12px; padding: 10px;
      width: 100%; max-width: 520px; flex-shrink: 0; box-shadow: 0 4px 15px rgba(0,0,0,0.4); display: block;
      overflow-x: auto; -webkit-overflow-scrolling: touch;
    }
    .mini-card h4{
      margin: 0 0 8px 0; font-size: 12px; font-weight: 800; color: var(--bad);
      border-bottom: 1px solid var(--line); padding-bottom: 5px; white-space: nowrap;
    }
    .mini-table{ width: 100%; min-width: 280px; border-collapse: collapse; font-size: 10px; table-layout: fixed; }
    .mini-table th{ background: none; padding: 4px 3px; color: var(--muted); border-bottom: 1px solid var(--line); font-weight: 800; text-align: left; white-space: nowrap; }
    .mini-table td{ padding: 6px 3px; border-bottom: 1px solid rgba(255,255,255,0.03); overflow: hidden; text-overflow: ellipsis; }

    .best-date { width: 18% !important; color: var(--muted); font-family: 'Roboto Mono', monospace; }
    .best-name { width: 35% !important; white-space: normal !important; overflow: visible !important; text-overflow: clip !important; line-height: 1.2; }
    .best-sig  { width: 27% !important; text-align: center; }
    .best-perf { width: 20% !important; text-align: right; }

    .badge-sig{ display: inline-flex; align-items: center; padding: 1px 3px; border-radius: 8px; font-size: 9px; font-weight: 800; margin-right: 1px; }
    .badge-sig::before{ content: ""; width: 3px; height: 3px; border-radius: 50%; display: inline-block; margin-right: 2px; }
    .sig-trend { background: rgba(16, 185, 129, 0.15); color: #34d399; } .sig-trend::before { background: #34d399; }
    .sig-pullback { background: rgba(245, 158, 11, 0.15); color: #fbbf24; } .sig-pullback::before { background: #fbbf24; }
    .sig-breakout { background: rgba(239, 68, 68, 0.15); color: #fb7185; } .sig-breakout::before { background: #fb7185; }
    .sig-alert { background: rgba(244, 63, 94, 0.2); color: #fb7185; border: 1px solid rgba(244, 63, 94, 0.3); animation: pulse 2s infinite; }
    @keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.6; } 100% { opacity: 1; } }

    /* âœ… Dailypick Type Badge (ìŠ¹ë¥ /ìˆ˜ìµìœ¨/íˆë“ ) */
    .dp-badge{
      display:inline-flex; align-items:center; justify-content:center;
      padding: 3px 10px; border-radius: 999px;
      font-size: 10px; font-weight: 900; line-height: 1;
      letter-spacing: -0.2px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.25);
      white-space: nowrap;
    }
    .dp-red{
      background: rgba(239, 68, 68, 0.20);
      border: 1px solid rgba(239, 68, 68, 0.40);
      color: #fecaca;
    }
    .dp-yellow{
      background: rgba(245, 158, 11, 0.20);
      border: 1px solid rgba(245, 158, 11, 0.40);
      color: #fde68a;
    }
    .dp-green{
      background: rgba(34, 197, 94, 0.18);
      border: 1px solid rgba(34, 197, 94, 0.35);
      color: #bbf7d0;
    }
    .dp-gray{
      background: rgba(148, 163, 184, 0.15);
      border: 1px solid rgba(148, 163, 184, 0.25);
      color: #e5e7eb;
    }

    /* âœ… Dailypick í—¤ë”(ìš”ì•½ë¬¸) ëª¨ë°”ì¼ ê°€ë…ì„± ê°œì„  */
    .daily-header{
      padding: 10px;
      border-bottom: 1px solid var(--line);
      font-weight:700;
      background: var(--panel2);
      display:flex;
      justify-content:space-between;
      align-items:flex-start;
      gap:10px;
    }
    .daily-summary{
      font-size: 11px;
      color: var(--muted);
      font-weight: 800;
      line-height: 1.25;
      text-align: right;
      max-width: 70%;
    }
    .daily-summary span{ display:inline; }
    .daily-summary .sum-profit{ color:#e5e7eb; font-weight:900; }

    @media (max-width: 520px){
      .daily-header{
        flex-direction: column;
        align-items: flex-start;
        gap: 6px;
      }
      .daily-summary{
        max-width: 100%;
        width: 100%;
        text-align: left;
        font-size: 12px;
      }
      .daily-summary span{
        display:block;
        white-space: normal;
      }
    }

    .info-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; padding: 20px; background: rgba(255,255,255,0.02); }
    .info-item { display: flex; flex-direction: column; gap: 4px; }
    .info-label { font-size: 11px; color: var(--muted); }
    .info-value { font-size: 16px; font-weight: 700; color: #fff; }

    .card { border:1px solid var(--line); background: var(--panel); border-radius: var(--radius); padding: 10px; cursor: pointer; transition: 0.2s; }
    .card:hover { border-color: var(--accent); transform: translateY(-1px); }
  </style>
</head>
<body>
<div class="app">
  <div class="header-section">
    <div style="padding: 12px 20px; border-bottom: 1px solid var(--line); display:flex; justify-content:space-between; align-items:center; background: rgba(15,26,46,0.95);">
      <div style="display:flex; align-items:center; gap:10px;">
        <div style="width:32px; height:32px; background:linear-gradient(135deg, #3b82f6, #10b981); border-radius:8px; display:flex; align-items:center; justify-content:center; font-weight:bold; font-size:18px;">Q</div>
        <div>
          <div style="font-size: 16px; font-weight:800; color:#fff;">YJ K-STOCK QUANT</div>
          <div id="statusLine" style="font-size: 10px; color: var(--muted);">ë°ì´í„° ë™ê¸°í™” ëŒ€ê¸° ì¤‘...</div>
        </div>
      </div>
      <button style="padding: 8px 16px; border-radius: 8px; background: rgba(52, 211, 153, 0.1); border:1px solid rgba(52, 211, 153, 0.3); color:#34d399; font-weight:bold; cursor:pointer; font-size:12px;" id="btnRefresh">ğŸ”„ ë°ì´í„° ê°±ì‹ </button>
    </div>

    <div class="tabbar">
      <button class="tab-btn on" id="tabScreen">ğŸ” ì‹¤ì‹œê°„ í¬ì°©</button>
      <button class="tab-btn" id="tabPerf">ğŸ“Š ì„±ê³¼ ì¶”ì </button>
      <button class="tab-btn" id="tabDaily">ğŸ“… Dailypick</button>

      <div id="perfFilterGroup">
        <button class="filter-btn active" onclick="setPerfFilter('ALL', this)" data-filter="ALL">ì „ì²´</button>
        <button class="filter-btn" onclick="setPerfFilter('TREND', this)" data-filter="TREND">ì¶”ì„¸</button>
        <button class="filter-btn" onclick="setPerfFilter('PULLBACK', this)" data-filter="PULLBACK">ëˆŒë¦¼</button>
        <button class="filter-btn" onclick="setPerfFilter('BREAKOUT', this)" data-filter="BREAKOUT">ëŒíŒŒ</button>
        <button class="filter-btn" onclick="setPerfFilter('SELL', this)" data-filter="SELL">ë§¤ë„í¬ì°©</button>
      </div>
    </div>
  </div>

  <div class="main">
    <div class="content-area">

      <!-- ì‹¤ì‹œê°„ í¬ì°© -->
      <section id="screenView" style="display: flex; flex-direction: column; height: 100%;">
        <div style="display:grid; grid-template-columns: repeat(4, 1fr); gap:8px; margin-bottom:15px; flex-shrink: 0;">
          <div class="card" onclick="switchList('ALL')">
            <div style="font-size:10px; color:var(--muted); margin-bottom:4px;">ì „ì²´</div>
            <div style="font-size:20px; font-weight:800;" id="statAll">-</div>
          </div>
          <div class="card" onclick="switchList('TREND')">
            <div style="font-size:10px; color:#34d399; margin-bottom:4px;">ì¶”ì„¸</div>
            <div style="font-size:20px; font-weight:800; color:#34d399;" id="statTrend">-</div>
          </div>
          <div class="card" onclick="switchList('PULLBACK')">
            <div style="font-size:10px; color:#fbbf24; margin-bottom:4px;">ëˆŒë¦¼</div>
            <div style="font-size:20px; font-weight:800; color:#fbbf24;" id="statPullback">-</div>
          </div>
          <div class="card" onclick="switchList('BREAKOUT')">
            <div style="font-size:10px; color:#fb7185; margin-bottom:4px;">ëŒíŒŒ</div>
            <div style="font-size:20px; font-weight:800; color:#fb7185;" id="statBreakout">-</div>
          </div>
        </div>

        <div class="table-container">
          <div style="padding: 12px 15px; border-bottom: 1px solid var(--line); display:flex; justify-content:space-between; align-items:center; background: rgba(255,255,255,0.02); z-index: 30;">
            <span id="listTitle" style="font-weight:700; font-size:14px; color:var(--accent);">ë¦¬ìŠ¤íŠ¸: ì „ì²´ë³´ê¸°</span>
          </div>
          <div class="table-responsive custom-scroll">
            <table id="mainTable">
              <thead>
                <tr>
                  <th class="col-code">ì½”ë“œ</th>
                  <th class="col-name">ì¢…ëª©ëª…</th>
                  <th class="col-price numRight">í˜„ì¬ê°€</th>
                  <th class="col-rsi numRight">RSI</th>
                  <th class="col-stoch numRight">Stoch K</th>
                  <th class="col-turn numRight">ê±°ë˜ëŒ€ê¸ˆ</th>
                  <th class="col-sig" style="text-align:center;">ì‹œê·¸ë„</th>
                </tr>
              </thead>
              <tbody id="screenTbody"></tbody>
            </table>
          </div>
        </div>
      </section>

      <!-- ì„±ê³¼ ì¶”ì  -->
      <section id="perfView" style="display:none; flex-direction: column; height: 100%;">
        <div class="top-stats-container">
          <div class="mini-card">
            <h4 id="bestTitle">ğŸ”¥ ìˆ˜ìµë¥  Best 5 (ì „ì²´)</h4>
            <table class="mini-table">
              <thead>
                <tr>
                  <th class="best-date">í¬ì°©ì¼</th>
                  <th class="best-name">ì¢…ëª©ëª…</th>
                  <th class="best-sig">ì‹œê·¸ë„</th>
                  <th class="best-perf">ìˆ˜ìµë¥ </th>
                </tr>
              </thead>
              <tbody id="bestTbody"></tbody>
            </table>
          </div>
        </div>

        <div class="table-container">
          <div style="padding: 10px; border-bottom: 1px solid var(--line); font-weight:700; background: var(--panel2); display:flex; justify-content:space-between; align-items: center;">
            <span style="font-size:13px;">ì„±ê³¼ ì¶”ì  ë³´ë“œ</span>
            <span style="font-size:9px; color:var(--muted); font-weight:normal;">í—¤ë” í´ë¦­ ì‹œ ì •ë ¬</span>
          </div>
          <div class="table-responsive custom-scroll">
            <table>
              <thead>
                <tr>
                  <th class="col-date">í¬ì°©ì¼</th>
                  <th class="col-code">ì½”ë“œ</th>
                  <th class="col-name">ì¢…ëª©ëª…</th>
                  <th class="col-sig" style="text-align:center;">ì‹œê·¸ë„</th>
                  <th class="col-sell" style="text-align:center;">ë§¤ë„ì‹ í˜¸</th>
                  <th class="col-price numRight">í¬ì°©ê°€</th>
                  <th class="col-price numRight">í˜„ì¬ê°€</th>

                  <th class="col-perf numRight sortable" id="sort-Return">ìˆ˜ìµë¥ </th>
                  <th class="col-perf numRight sortable" id="sort-D1">D1</th>
                  <th class="col-perf numRight sortable" id="sort-D3">D3</th>
                  <th class="col-perf numRight sortable" id="sort-D5">D5</th>
                  <th class="col-perf numRight sortable" id="sort-D7">D7</th>
                  <th class="col-perf numRight sortable" id="sort-D9">D9</th>
                </tr>
              </thead>
              <tbody id="perfTbody"></tbody>
            </table>
          </div>
        </div>
      </section>

      <!-- Dailypick -->
      <section id="dailyView" style="display:none; flex-direction: column; height: 100%;">
        <div class="table-container">
          <div class="daily-header">
            <span style="font-size:13px;">ğŸ“… Dailypick ë¡œê·¸(ëª©í‘œê°€ ë§¤ë„/ë¯¸ë„ë‹¬ ì‹œ D5 ì¢…ê°€ ì²­ì‚°)</span>
            <span id="dailySummary" class="daily-summary"></span>
          </div>

          <div class="table-responsive custom-scroll">
            <table style="min-width: 1220px;">
              <thead>
                <tr>
                  <th class="col-date">Pickì¼ì</th>
                  <th class="col-type" style="text-align:center;">Type</th>
                  <th class="col-code">ì½”ë“œ</th>
                  <th class="col-name">ì¢…ëª©ëª…</th>
                  <th class="col-price numRight">ë§¤ìˆ˜ê°€</th>

                  <th class="col-target numRight">ëª©í‘œ1</th>
                  <th class="col-target numRight">ëª©í‘œ2</th>
                  <th class="col-stop numRight">ì†ì ˆ1</th>
                  <th class="col-stop numRight">ì†ì ˆ2</th>

                  <th class="col-price numRight">í˜„ì¬ê°€</th>

                  <th class="col-price numRight">ì‹¤ë§¤ë„1(50%)</th>
                  <th class="col-price numRight">ì‹¤ë§¤ë„2(50%)</th>
                  <th class="col-perf numRight">ìˆ˜ìµìœ¨(%)</th>

                  <th class="col-pnl numRight">ì†ìµ</th>
                </tr>
              </thead>
              <tbody id="dailyTbody"></tbody>
            </table>
          </div>
        </div>
      </section>

    </div>

    <!-- ë””í…Œì¼ íŒ¨ë„ -->
    <div id="detailPanel">
      <div style="padding: 15px 20px; border-bottom: 1px solid var(--line); display:flex; justify-content:space-between; align-items:center; background:var(--panel2); flex-shrink: 0;">
        <div>
          <span id="detailCode" style="font-family:monospace; font-size:12px; color:var(--accent); display:block; margin-bottom:2px;">CODE</span>
          <b id="detailName" style="font-size:18px;">ì¢…ëª© ì„ íƒ</b>
        </div>
        <button onclick="closeDetail()" style="background:none; border:none; color:var(--muted); font-size:20px; cursor:pointer;">âœ•</button>
      </div>

      <div class="info-grid" id="detailStats" style="flex-shrink: 0;">
        <div class="info-item">
          <div class="info-label">í˜„ì¬ê°€</div><div class="info-value" id="valPrice">-</div>
        </div>
        <div class="info-item">
          <div class="info-label">ê±°ë˜ëŒ€ê¸ˆ</div><div class="info-value" id="valTurnover">-</div>
        </div>
        <div class="info-item">
          <div class="info-label">RSI (14)</div><div class="info-value" id="valRSI">-</div>
        </div>
        <div class="info-item">
          <div class="info-label">Stochastic K</div><div class="info-value" id="valStoch">-</div>
        </div>
        <div class="info-item" style="grid-column: span 2;">
          <div class="info-label">í¬ì°© ì‹œê·¸ë„</div><div id="valSignals" style="display:flex; flex-wrap:wrap; gap:4px; margin-top:5px;">-</div>
        </div>
      </div>
      <div id="chartContainer" style="flex:1; background:#000; border-top:1px solid var(--line);"></div>
    </div>
  </div>
</div>

<script>
const setVh = () => {
  let vh = window.innerHeight * 0.01;
  document.documentElement.style.setProperty('--vh', `${vh}px`);
};
window.addEventListener('resize', setVh);
setVh();

/* âœ… ì—¬ê¸° Dailypick CSV URLë§Œ êµì²´í•˜ë©´ ë¨ */
const URLS = {
  ALL: "https://docs.google.com/spreadsheets/d/e/2PACX-1vSsPovUyvREyTUmaoACXouBLKs4RXyZgoco6l9xV08L2hIZeoZHJTdEv4drJeOJHnNoY2o2k3XsIf_y/pub?gid=0&single=true&output=csv",
  TREND: "https://docs.google.com/spreadsheets/d/e/2PACX-1vSsPovUyvREyTUmaoACXouBLKs4RXyZgoco6l9xV08L2hIZeoZHJTdEv4drJeOJHnNoY2o2k3XsIf_y/pub?gid=1981708246&single=true&output=csv",
  PULLBACK: "https://docs.google.com/spreadsheets/d/e/2PACX-1vSsPovUyvREyTUmaoACXouBLKs4RXyZgoco6l9xV08L2hIZeoZHJTdEv4drJeOJHnNoY2o2k3XsIf_y/pub?gid=852505203&single=true&output=csv",
  BREAKOUT: "https://docs.google.com/spreadsheets/d/e/2PACX-1vSsPovUyvREyTUmaoACXouBLKs4RXyZgoco6l9xV08L2hIZeoZHJTdEv4drJeOJHnNoY2o2k3XsIf_y/pub?gid=258627301&single=true&output=csv",
  STORAGE: "https://docs.google.com/spreadsheets/d/e/2PACX-1vSsPovUyvREyTUmaoACXouBLKs4RXyZgoco6l9xV08L2hIZeoZHJTdEv4drJeOJHnNoY2o2k3XsIf_y/pub?gid=2034892211&single=true&output=csv",
  DAILYPICK: "https://docs.google.com/spreadsheets/d/e/2PACX-1vSsPovUyvREyTUmaoACXouBLKs4RXyZgoco6l9xV08L2hIZeoZHJTdEv4drJeOJHnNoY2o2k3XsIf_y/pub?gid=1927472233&single=true&output=csv"
};

let data = { ALL:[], TREND:[], PULLBACK:[], BREAKOUT:[], STORAGE:[], DAILYPICK:[] };
let currentMode = 'ALL';
let perfSortKey = null;
let perfSortDir = 'original';
let perfFilter = 'ALL';

function parseCSV(text) {
  const rows = [];
  const lines = text.split(/\r?\n/);
  for (let line of lines) {
    if (!line.trim()) continue;
    const row = [];
    let curVal = "", inQuotes = false;
    for (let i = 0; i < line.length; i++) {
      const char = line[i];
      if (char === '"') {
        if (inQuotes && line[i+1] === '"') { curVal += '"'; i++; }
        else inQuotes = !inQuotes;
      } else if (char === ',' && !inQuotes) { row.push(curVal.trim()); curVal = ""; }
      else curVal += char;
    }
    row.push(curVal.trim());
    rows.push(row);
  }
  if (!rows.length) return [];
  const header = rows.shift().map(h => h.trim());
  return rows.map(r => {
    let obj = {};
    header.forEach((h, i) => { obj[h] = (r[i] !== undefined) ? String(r[i]).trim() : ""; });
    return obj;
  });
}

function numFrom(v){
  const n = parseFloat(String(v ?? "").replace(/[^-0-9.]/g, ""));
  return isNaN(n) ? 0 : n;
}
function fmtPrice(v){
  const n = numFrom(v);
  return (v === "" || v === null || v === undefined) ? "-" : n.toLocaleString('ko-KR');
}
function fmtPriceWon(v){
  const n = numFrom(v);
  return (v === "" || v === null || v === undefined) ? "-" : n.toLocaleString('ko-KR') + "ì›";
}
function fmtTurnover(n) {
  if (!n) return "-";
  const num = numFrom(n);
  return Math.floor(num / 100000000).toLocaleString() + "ì–µ";
}
function fmtPct(v){
  const x = parseFloat(String(v || "").replace('%',''));
  return isNaN(x) ? "-" : (x > 0 ? "+" : "") + x.toFixed(1) + "%";
}
function pctColor(v){
  const x = parseFloat(String(v || "").replace('%',''));
  return isNaN(x) ? '#fff' : (x > 0 ? 'var(--bad)' : '#fff');
}
function fmtWon(v){
  const n = Math.round(numFrom(v));
  const abs = Math.abs(n).toLocaleString('ko-KR');
  return (n < 0 ? "-â‚©" : "â‚©") + abs;
}

function pick(r, keys){
  for(const k of keys){
    if (r[k] !== undefined && r[k] !== null && String(r[k]).trim() !== "") return r[k];
  }
  return "";
}

function parsePickDate(s){
  const raw = String(s || "").trim();
  if(!raw) return null;
  const part = raw.split(" ")[0];
  const cleaned = part.replace(/\./g,'-').replace(/\//g,'-');
  const m = cleaned.match(/^(\d{4})-(\d{1,2})-(\d{1,2})$/);
  if(!m) return null;
  const y = +m[1], mo = +m[2]-1, d = +m[3];
  const dt = new Date(y, mo, d);
  return isNaN(dt.getTime()) ? null : dt;
}
function pad2(n){ return String(n).padStart(2,'0'); }
function fmtMonthDay(dt){
  return `${pad2(dt.getMonth()+1)}ì›” ${pad2(dt.getDate())}ì¼`;
}

function getSigCount(r) {
  let count = 0;
  if(String(r.Trend).toUpperCase()==="TRUE") count++;
  if(String(r.Pullback).toUpperCase()==="TRUE") count++;
  if(String(r.Breakout).toUpperCase()==="TRUE") count++;
  return count;
}

function checkSignal(r, type) {
  if (type === 'ALL') return true;

  if (type === 'SELL') {
    const bbUpper = numFrom(r.BB_Upper || 0);
    const current = numFrom(r.Close_Today || 0);
    const sheetSellSignal = String(r['ë§¤ë„ì‹ í˜¸'] || "").trim().toUpperCase();
    return (sheetSellSignal === "TRUE") || (bbUpper > 0 && current > (bbUpper * 1.03));
  }

  let colVal = "";
  if (type === 'TREND') colVal = r.Trend;
  else if (type === 'PULLBACK') colVal = r.Pullback;
  else if (type === 'BREAKOUT') colVal = r.Breakout;
  if (String(colVal).toUpperCase() === 'TRUE') return true;

  const rowStr = Object.values(r).join(" ").toUpperCase();
  const map = { 'TREND': 'ì¶”ì„¸', 'PULLBACK': 'ëˆŒë¦¼', 'BREAKOUT': 'ëŒíŒŒ' };
  return (rowStr.includes(type) || rowStr.includes(map[type]));
}

function getBadges(r) {
  let h = "";
  if(String(r.Trend).toUpperCase()==="TRUE") h += '<span class="badge-sig sig-trend">ì¶”ì„¸</span>';
  if(String(r.Pullback).toUpperCase()==="TRUE") h += '<span class="badge-sig sig-pullback">ëˆŒë¦¼</span>';
  if(String(r.Breakout).toUpperCase()==="TRUE") h += '<span class="badge-sig sig-breakout">ëŒíŒŒ</span>';

  if (!h) {
    const rowValues = Object.values(r).join(" ").toUpperCase();
    if(rowValues.includes("TREND") || rowValues.includes("ì¶”ì„¸")) h += '<span class="badge-sig sig-trend">ì¶”ì„¸</span>';
    if(rowValues.includes("PULLBACK") || rowValues.includes("ëˆŒë¦¼")) h += '<span class="badge-sig sig-pullback">ëˆŒë¦¼</span>';
    if(rowValues.includes("BREAKOUT") || rowValues.includes("ëŒíŒŒ")) h += '<span class="badge-sig sig-breakout">ëŒíŒŒ</span>';
  }
  return h || "-";
}

/* âœ… Dailypick Type Badge: ìŠ¹ë¥ =ë¹¨ê°•, ìˆ˜ìµìœ¨=ë…¸ë‘, íˆë“ =ì´ˆë¡ */
function dailyTypeBadge(type){
  const t = String(type || "").trim();
  if(!t) return '<span class="dp-badge dp-gray">-</span>';

  if (t.includes("ìŠ¹")) return '<span class="dp-badge dp-red">ìŠ¹ë¥ </span>';
  if (t.includes("ìˆ˜ìµ")) return '<span class="dp-badge dp-yellow">ìˆ˜ìµìœ¨</span>';
  if (t.includes("íˆë“ ")) return '<span class="dp-badge dp-green">íˆë“ </span>';

  return `<span class="dp-badge dp-gray">${t}</span>`;
}

function openDetail(r) {
  const panel = document.getElementById('detailPanel');
  panel.style.display = 'flex';
  document.getElementById('detailName').textContent = r.Name || pick(r, ["ì¢…ëª©ëª…","name"]);
  document.getElementById('detailCode').textContent = String(r.Code || pick(r, ["ì½”ë“œ","code"])).padStart(6,'0');

  const closeVal = r.Close || r.Close_Today || r.EntryPrice || r['í˜„ì¬ê°€'] || r['ë§¤ìˆ˜ê°€'];
  document.getElementById('valPrice').textContent = fmtPriceWon(closeVal);

  document.getElementById('valTurnover').textContent = fmtTurnover(r.Turnover || r['ê±°ë˜ëŒ€ê¸ˆ']);
  document.getElementById('valRSI').textContent = r.RSI14 ? numFrom(r.RSI14).toFixed(1) : "-";
  document.getElementById('valStoch').textContent = r.Stoch_K ? numFrom(r.Stoch_K).toFixed(1) : "-";
  document.getElementById('valSignals').innerHTML = getBadges(r);

  if(window.innerWidth <= 1024) panel.scrollIntoView({behavior:'smooth'});

  document.getElementById('chartContainer').innerHTML = "";
  new TradingView.widget({
    "autosize": true, "symbol": "KRX:" + String(r.Code || pick(r, ["ì½”ë“œ","code"])).padStart(6, '0'),
    "interval": "D", "timezone": "Asia/Seoul", "theme": "dark", "style": "1", "locale": "ko",
    "container_id": "chartContainer", "hide_top_toolbar": true
  });
}

function closeDetail() { document.getElementById('detailPanel').style.display = 'none'; }

async function load() {
  const status = document.getElementById('statusLine');
  status.textContent = "Syncing...";
  try{
    const ts = Date.now();
    for(const key of Object.keys(URLS)) {
      const res = await fetch(URLS[key] + "&ts=" + ts);
      const parsed = parseCSV(await res.text());
      if(key === 'DAILYPICK') data.DAILYPICK = parsed;
      else data[key] = parsed;
    }
    render();
    status.textContent = "Updated: " + new Date().toLocaleTimeString();
  }catch(e){
    console.error(e);
    status.textContent = "Error";
  }
}

function handlePerfSort(key) {
  if (perfSortKey === key) {
    if (perfSortDir === 'original') perfSortDir = 'desc';
    else if (perfSortDir === 'desc') perfSortDir = 'asc';
    else perfSortDir = 'original';
  } else {
    perfSortKey = key;
    perfSortDir = 'desc';
  }
  render();
}

function setPerfFilter(filterType, btn) {
  perfFilter = filterType;
  document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
  btn.classList.add('active');
  render();
}

function render() {
  document.getElementById('statAll').textContent = (data.ALL||[]).length;
  document.getElementById('statTrend').textContent = (data.TREND||[]).length;
  document.getElementById('statPullback').textContent = (data.PULLBACK||[]).length;
  document.getElementById('statBreakout').textContent = (data.BREAKOUT||[]).length;

  // --- Screen View ---
  const list = data[currentMode] || [];
  const sortedList = [...list].sort((a, b) => {
    const cB = getSigCount(b), cA = getSigCount(a);
    if (cB !== cA) return cB - cA;
    return numFrom(b.Turnover) - numFrom(a.Turnover);
  });

  document.getElementById('screenTbody').innerHTML = sortedList.map(r => {
    const rsiVal = numFrom(r.RSI14 || 0), stochVal = numFrom(r.Stoch_K || 0);
    return `
      <tr class="clickable" onclick='openDetail(${JSON.stringify(r)})'>
        <td class="col-code" style="color:var(--muted); font-family:monospace;">${String(r.Code).padStart(6,'0')}</td>
        <td class="col-name" style="font-weight:700; color:#fff;">${r.Name}</td>
        <td class="col-price numRight">${fmtPriceWon(r.Close)}</td>
        <td class="col-rsi numRight" style="color:${rsiVal >= 70 ? 'var(--bad)' : 'inherit'};">${rsiVal.toFixed(1)}</td>
        <td class="numRight col-stoch" style="color:${stochVal >= 80 ? 'var(--bad)' : 'inherit'};">${stochVal.toFixed(1)}</td>
        <td class="numRight col-turn" style="color:var(--muted)">${fmtTurnover(r.Turnover)}</td>
        <td class="col-sig" style="text-align:center;">${getBadges(r)}</td>
      </tr>
    `;
  }).join('');

  // --- Performance View ---
  const rawStorage = (data.STORAGE || []);
  let storageList = [...rawStorage].reverse();

  if (perfFilter !== 'ALL') storageList = storageList.filter(r => checkSignal(r, perfFilter));

  const mapTitle = { 'ALL': '(ì „ì²´)', 'TREND': '(ì¶”ì„¸)', 'PULLBACK': '(ëˆŒë¦¼)', 'BREAKOUT': '(ëŒíŒŒ)', 'SELL': '(ë§¤ë„í¬ì°©)' };
  document.getElementById('bestTitle').textContent = `ğŸ”¥ ìˆ˜ìµë¥  Best 5 ${mapTitle[perfFilter] || ''}`;

  const calcList = [...storageList].map(item => ({
    ...item,
    _valReturn: parseFloat(String(item.Return || "").replace('%','')) || -999
  })).sort((a, b) => b._valReturn - a._valReturn);

  document.getElementById('bestTbody').innerHTML = calcList.slice(0, 5).map(r => `
    <tr class="clickable" onclick='openDetail(${JSON.stringify(r)})'>
      <td class="best-date">${(r.DetectDate || "").split(' ')[0].substring(5)}</td>
      <td class="best-name">${r.Name}</td>
      <td class="best-sig">${getBadges(r)}</td>
      <td class="best-perf" style="color:var(--bad); font-weight:800;">${fmtPct(r.Return)}</td>
    </tr>
  `).join('');

  // âœ… Sorting (Return/D1/D3/D5/D7/D9)
  if (perfSortKey && perfSortDir !== 'original') {
    storageList.sort((a, b) => {
      const vA = parseFloat(String(a[perfSortKey] || "").replace('%',''));
      const vB = parseFloat(String(b[perfSortKey] || "").replace('%',''));
      const aVal = isNaN(vA) ? -999 : vA;
      const bVal = isNaN(vB) ? -999 : vB;
      return perfSortDir === 'desc' ? (bVal - aVal) : (aVal - bVal);
    });
  }

  document.querySelectorAll('th.sortable').forEach(th => {
    const key = th.id.replace('sort-', '');
    th.classList.remove('sort-desc', 'sort-asc');
    if (key === perfSortKey && perfSortDir !== 'original') th.classList.add('sort-' + perfSortDir);
  });

  document.getElementById('perfTbody').innerHTML = storageList.length
    ? storageList.map(r => {
        const entry = numFrom(r.EntryPrice || 0);
        const current = numFrom(r.Close_Today || 0);

        const bbUpper = numFrom(r.BB_Upper || 0);
        const sheetSellSignal = String(r['ë§¤ë„ì‹ í˜¸'] || "").trim().toUpperCase();
        const isSellSignal = (sheetSellSignal === "TRUE") || (bbUpper > 0 && current > (bbUpper * 1.03));
        const sellBadge = isSellSignal ? '<span class="badge-sig sig-alert">ë§¤ë„í¬ì°©</span>' : '<span style="color:var(--muted); font-size:10px;">-</span>';

        return `
          <tr class="clickable" onclick='openDetail(${JSON.stringify(r)})'>
            <td class="col-date" style="color:var(--muted)">${(r.DetectDate || "").split(' ')[0]}</td>
            <td class="col-code">${String(r.Code).padStart(6,'0')}</td>
            <td class="col-name" style="font-weight:700;">${r.Name}</td>
            <td class="col-sig" style="text-align:center;">${getBadges(r)}</td>
            <td class="col-sell" style="text-align:center;">${sellBadge}</td>
            <td class="col-price numRight" style="color:var(--muted)">${fmtPriceWon(r.EntryPrice)}</td>
            <td class="col-price numRight" style="color:${current > entry ? 'var(--bad)' : '#fff'};">${fmtPriceWon(r.Close_Today)}</td>

            <td class="col-perf numRight" style="color:${pctColor(r.Return)}; font-weight:700;">${fmtPct(r.Return)}</td>
            <td class="col-perf numRight" style="color:${pctColor(r.D1)}">${fmtPct(r.D1)}</td>
            <td class="col-perf numRight" style="color:${pctColor(r.D3)}">${fmtPct(r.D3)}</td>
            <td class="col-perf numRight" style="color:${pctColor(r.D5)}">${fmtPct(r.D5)}</td>
            <td class="col-perf numRight" style="color:${pctColor(r.D7)}">${fmtPct(r.D7)}</td>
            <td class="col-perf numRight" style="color:${pctColor(r.D9)}">${fmtPct(r.D9)}</td>
          </tr>
        `;
      }).join('')
    : `<tr><td colspan="13" style="text-align:center; padding:20px; color:var(--muted);">í•´ë‹¹ ì¡°ê±´ì˜ ì¢…ëª©ì´ ì—†ìŠµë‹ˆë‹¤.</td></tr>`;

  // --- Dailypick View ---
  const dp = (data.DAILYPICK || []).slice().reverse();

  // e. ê¸°ê°„(ìµœì†Œ~ìµœëŒ€ Pickì¼ì) + ì†ìµ í•©ê³„ + Pick/ì²­ì‚°/ë³´ìœ  ì¹´ìš´íŠ¸
  let minDt = null, maxDt = null;
  let sumPnL = 0;

  let totalPickCnt = dp.length;
  let closedCnt = 0; // ì²­ì‚° ì¢…ëª© ìˆ˜(ì‹¤ë§¤ë„1&2 ì¡´ì¬ + ì†ìµ ë°œìƒ)
  let holdingCnt = 0;

  dp.forEach(r => {
    // ë‚ ì§œ min/max
    const pickDate = pick(r, ["Pickì¼ì","PickDate","pick_date","Date","date"]);
    const dt = parsePickDate(pickDate);
    if (dt) {
      if (!minDt || dt < minDt) minDt = dt;
      if (!maxDt || dt > maxDt) maxDt = dt;
    }

    // ì†ìµ í•©ê³„
    const pnlRaw = pick(r, ["gain/loss","Gain/Loss","gain_loss","gainloss","ì†ìµ"]);
    const pnlNum = numFrom(pnlRaw);
    sumPnL += pnlNum;

    // ì²­ì‚° íŒë‹¨: ì‹¤ë§¤ë„1 + ì‹¤ë§¤ë„2 ê°’ì´ ìˆê³ , ì†ìµì´ 0ì´ ì•„ë‹Œ ê²½ìš°
    const sell1 = pick(r, ["ì‹¤ë§¤ë„1","Selling1","SellingPrice1","sell1"]);
    const sell2 = pick(r, ["ì‹¤ë§¤ë„2","Selling2","SellingPrice2","sell2"]);

    const hasSell1 = String(sell1 ?? "").trim() !== "" && numFrom(sell1) !== 0;
    const hasSell2 = String(sell2 ?? "").trim() !== "" && numFrom(sell2) !== 0;
    const hasPnL  = String(pnlRaw ?? "").trim() !== "" && pnlNum !== 0;

    if (hasSell1 && hasSell2 && hasPnL) closedCnt++;
  });

  // ë³´ìœ  = ì „ì²´ - ì²­ì‚°
  holdingCnt = Math.max(0, totalPickCnt - closedCnt);

  const summaryEl = document.getElementById('dailySummary');
  if (minDt && maxDt) {
    summaryEl.textContent =
      `${fmtMonthDay(minDt)} ~ ${fmtMonthDay(maxDt)} ` +
      `Pick ${totalPickCnt}ì¢…ëª©, ì²­ì‚° ${closedCnt}ì¢…ëª©, ë³´ìœ  ${holdingCnt}ì¢…ëª©, ` +
      `ì¢…ëª© ë‹¹ 1ì²œë§Œì› ë§¤ë§¤ ì‹œ ì´ ìˆ˜ìµ ${fmtWon(sumPnL)}ì›`;
  } else {
    summaryEl.textContent = `ê¸°ê°„/ì†ìµ ê³„ì‚° ëŒ€ê¸°`;
  }

  document.getElementById('dailyTbody').innerHTML = dp.length
    ? dp.map(r => {
        const pickDate = pick(r, ["Pickì¼ì","PickDate","pick_date","Date","date"]);
        const type = pick(r, ["Type","type","ì „ëµ","ì „ëµêµ¬ë¶„"]);
        const code = pick(r, ["Code","code","ì¢…ëª©ì½”ë“œ","ì½”ë“œ"]);
        const name = pick(r, ["Name","name","ì¢…ëª©ëª…"]);
        const entry = pick(r, ["ë§¤ìˆ˜ê°€","EntryPrice","entry","entry_price"]);
        const target1 = pick(r, ["ëª©í‘œ1","Target1","TargetPrice1","target1"]);
        const target2 = pick(r, ["ëª©í‘œ2","Target2","TargetPrice2","target2"]);
        const stop1 = pick(r, ["ì†ì ˆ1","Stop1","StopPrice1","stop1"]);
        const stop2 = pick(r, ["ì†ì ˆ2","Stop2","StopPrice2","stop2"]);
        const closeToday = pick(r, ["í˜„ì¬ê°€","Close_Today","CloseToday","close_today","Close"]);
        const sell1 = pick(r, ["ì‹¤ë§¤ë„1","Selling1","SellingPrice1","sell1"]);
        const sell2 = pick(r, ["ì‹¤ë§¤ë„2","Selling2","SellingPrice2","sell2"]);
        const ret = pick(r, ["ActualReturn","actualreturn","actual_return"]);
        const pnlRaw = pick(r, ["gain/loss","Gain/Loss","gain_loss","gainloss","ì†ìµ"]);

        const retNum = parseFloat(String(ret || "").replace('%',''));
        const retColor = (!isNaN(retNum) && retNum > 0) ? 'var(--bad)' : '#fff';

        /* âœ… (ì¶”ê°€) ì†ìµ ìƒ‰ìƒ: +ë©´ ë¹¨ê°•, 0/(-)ë©´ í°ìƒ‰ */
        const pnlNum = numFrom(pnlRaw);
        const pnlColor = pnlNum > 0 ? 'var(--bad)' : '#fff';

        return `
          <tr class="clickable" onclick='openDetail(${JSON.stringify({Code:code, Name:name, Close_Today:closeToday, EntryPrice:entry})})'>
            <td class="col-date" style="color:var(--muted)">${String(pickDate).split(' ')[0]}</td>

            <!-- âœ… Type ë±ƒì§€ ì ìš© -->
            <td class="col-type" style="text-align:center;">${dailyTypeBadge(type)}</td>

            <td class="col-code" style="font-family:monospace;">${String(code).padStart(6,'0')}</td>
            <td class="col-name" style="font-weight:700;">${name || '-'}</td>
            <td class="col-price numRight">${fmtPrice(entry)}</td>

            <!-- ëª©í‘œ ë¹¨ê°• -->
            <td class="col-target numRight" style="color:var(--bad); font-weight:700;">${fmtPrice(target1)}</td>
            <td class="col-target numRight" style="color:var(--bad); font-weight:700;">${fmtPrice(target2)}</td>

            <!-- ì†ì ˆ í°ìƒ‰ -->
            <td class="col-stop numRight" style="color:#fff;">${fmtPrice(stop1)}</td>
            <td class="col-stop numRight" style="color:#fff;">${fmtPrice(stop2)}</td>

            <td class="col-price numRight">${fmtPrice(closeToday)}</td>

            <!-- ì‹¤ë§¤ë„ í°ìƒ‰ -->
            <td class="col-price numRight" style="color:#fff;">${fmtPrice(sell1)}</td>
            <td class="col-price numRight" style="color:#fff;">${fmtPrice(sell2)}</td>

            <!-- ìˆ˜ìµìœ¨(%) +ì´ë©´ ë¹¨ê°• -->
            <td class="col-perf numRight" style="color:${retColor}; font-weight:800;">${fmtPct(ret)}</td>

            <!-- âœ… ì†ìµ(+ ë¹¨ê°• / 0Â·- í°ìƒ‰) -->
            <td class="col-pnl numRight" style="color:${pnlColor}; font-weight:900;">${fmtWon(pnlRaw)}</td>
          </tr>
        `;
      }).join('')
    : `<tr><td colspan="14" style="text-align:center; padding:20px; color:var(--muted);">Dailypick ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</td></tr>`;
}

document.querySelectorAll('th.sortable').forEach(th => {
  th.onclick = () => handlePerfSort(th.id.replace('sort-', ''));
});

function switchList(mode) {
  currentMode = mode;
  const map = { ALL:"ì „ì²´ë³´ê¸°", TREND:"TREND", PULLBACK:"PULLBACK", BREAKOUT:"BREAKOUT" };
  document.getElementById('listTitle').textContent = "ë¦¬ìŠ¤íŠ¸: " + (map[mode] || mode);
  render();
}

document.getElementById('tabScreen').onclick = () => {
  document.getElementById('screenView').style.display = 'flex';
  document.getElementById('perfView').style.display = 'none';
  document.getElementById('dailyView').style.display = 'none';
  document.getElementById('tabScreen').classList.add('on');
  document.getElementById('tabPerf').classList.remove('on');
  document.getElementById('tabDaily').classList.remove('on');
  document.getElementById('perfFilterGroup').style.display = 'none';
};

document.getElementById('tabPerf').onclick = () => {
  document.getElementById('screenView').style.display = 'none';
  document.getElementById('perfView').style.display = 'flex';
  document.getElementById('dailyView').style.display = 'none';
  document.getElementById('tabPerf').classList.add('on');
  document.getElementById('tabScreen').classList.remove('on');
  document.getElementById('tabDaily').classList.remove('on');
  document.getElementById('perfFilterGroup').style.display = 'flex';
  render();
};

document.getElementById('tabDaily').onclick = () => {
  document.getElementById('screenView').style.display = 'none';
  document.getElementById('perfView').style.display = 'none';
  document.getElementById('dailyView').style.display = 'flex';
  document.getElementById('tabDaily').classList.add('on');
  document.getElementById('tabScreen').classList.remove('on');
  document.getElementById('tabPerf').classList.remove('on');
  document.getElementById('perfFilterGroup').style.display = 'none';
  render();
};

document.getElementById('btnRefresh').onclick = load;
window.onload = load;
</script>
</body>
</html>
